#!/bin/zsh
set -e

# After brew installed goes here!
# cat << EOF >> ~/.bash_profile
# Add Visual Studio Code (code)
# export PATH="\$PATH:/Applications/Visual Studio Code.app/Contents/Resources/app/bin"
#EOF

# Symlink files/* into home directory as regular files
# for f in $(ls -d ~/.dotfiles/files/*); do ln -sfn $f ~/$(basename $f); done

# Hammerspoon
hammerspoondir=~/.hammerspoon
mkdir -p $hammerspoondir
echo "dowloading the Lunette spoon"
# download and copy over Lunette spoon
git clone git@github.com:scottwhudson/Lunette.git &> /dev/null
if [[ $? -eq 128 ]]; then
    echo "spoon repo already exists."
elif [[ $? -eq 0 ]]; then
    echo "Cloned spoon repo."
else
    echo "Failed to clone spoon repo."
fi
spoonsdir="$hammerspoondir/Spoons"
echo $spoonsdir
mkdir -p $spoonsdir
cp -R Lunette/Source/Lunette.spoon $spoonsdir
rm -rf Lunette

# symlink the init.lua
ln -sfn ~/.dotfiles/programs/hammerspoon/init.lua "$hammerspoondir/init.lua"

# Visual Studio Code
mkdir -p ~/Library/Application\ Support/Code/User
for f in $(ls -d ~/.dotfiles/programs/code/*.json); do ln -sfn $f ~/Library/Application\ Support/Code/User/$(basename $f); done
# install extensions
cat ~/.dotfiles/programs/code/extensions.txt | xargs -L 1 code --install-extension

# Set shell to be homebrew installed zsh
sudo dscl . -create /Users/$USER UserShell $(brew --prefix)/bin/zsh
echo "Successful after-setup"
